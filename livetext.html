<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title></title> 
    <style>
        /* CSS Variables for JS Control (Dimensions) */
        :root {
            --app-side-margin: 0px;
            --app-msg-gap: 10px;
            --app-input-gap: 20px;
            --app-msg-padding: 10px;
            --app-input-padding: 10px;
            --app-scale: 1;
        }

        /* Layout Essentials */
        body {
            margin: 0;
            padding: 0;
            /* dvh = Dynamic Viewport Height (handles mobile browser bars better than vh) */
            height: 100dvh; 
            width: 100vw;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-sizing: border-box;
            /* Font size is controlled by scale */
            font-size: calc(16px * var(--app-scale));
        }

        #message-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding-left: var(--app-side-margin);
            padding-right: var(--app-side-margin);
            padding-bottom: var(--app-input-gap);
            overflow-y: hidden;
        }

        #input-container {
            width: 100%;
            padding-left: var(--app-side-margin);
            padding-right: var(--app-side-margin);
            /* Add safe area for bottom (iPhone home bar, etc) */
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
        }

        #text-input {
            width: 100%;
            box-sizing: border-box;
            padding: var(--app-input-padding);
            font-size: inherit;
            outline: none;
        }

        .message-box {
            display: block;
            width: 100%;
            padding: var(--app-msg-padding);
            margin-top: var(--app-msg-gap);
            box-sizing: border-box;
            word-wrap: break-word;
            animation: slideUp 0.2s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- OPTIONS PANEL (MOBILE FIXED) --- */
        #options-wrapper { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            z-index: 1000; 
            pointer-events: none; /* Let clicks pass through empty areas */
        }
        
        #toggle-btn { 
            position: fixed; 
            /* Push down by safe area + 15px */
            top: calc(15px + env(safe-area-inset-top)); 
            left: 15px; 
            width: 35px; /* Slightly larger for touch */
            height: 35px; 
            cursor: pointer; 
            z-index: 1001; 
            transition: 0.2s;
            pointer-events: auto; /* Re-enable clicks for button */
        }

        #options-panel { 
            /* Push padding down so text doesn't overlap button on mobile */
            padding: calc(60px + env(safe-area-inset-top)) 20px 20px 20px; 
            display: block; 
            pointer-events: auto; /* Re-enable clicks for panel */
            max-height: 80vh; /* Prevent panel from being too tall */
            overflow-y: auto; /* Scroll options if screen is short */
        }

        #options-panel.hidden { display: none; }
        
        .option-row { display: flex; align-items: center; margin-bottom: 12px; font-size: 14px; }
        .option-label { width: 200px; flex-shrink: 0; }
        
        /* Drag Overlay */
        #drag-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white;
            display: none; align-items: center; justify-content: center;
            font-size: 2em; z-index: 2000; pointer-events: none;
        }
    </style>

    <style id="theme-style">
        /* --- DEFAULT "BASIC" THEME --- */
        body {
            background-color: white;
            color: black;
            font-family: "Times New Roman", serif;
        }
        
        /* Input Box Style */
        #text-input {
            background-color: #eee;
            color: black;
            border: 2px solid black;
        }

        /* Sent Message Style */
        .message-box {
            background-color: white;
            color: black;
            border: 2px solid black;
        }

        /* Options Panel Style */
        #options-panel {
            background-color: #eee;
            border-bottom: 2px solid black;
            color: black;
        }

        /* Toggle Button Style */
        #toggle-btn {
            background-color: black;      /* Color when panel is OPEN */
            border: 2px solid black;
        }
        #toggle-btn.minimized {
            background-color: white;      /* Color when panel is CLOSED */
        }

        /* Range Slider Defaults */
        input[type="range"] { accent-color: black; }
        
        button {
            cursor: pointer;
            padding: 5px 10px;
            background: white;
            border: 2px solid black;
            font-family: inherit;
        }
        button:hover { background: #ddd; }
    </style>
</head>
<body>

    <div id="drag-overlay">Drop CSS File to Apply</div>

    <div id="options-wrapper">
        <div id="toggle-btn" onclick="toggleOptions()"></div>
        
        <div id="options-panel">
            <div class="option-row">
                <span class="option-label">Side Margins (0-100px)</span>
                <input type="range" id="opt-side-margin" min="0" max="100" value="0" oninput="updateSettings()">
            </div>
            <div class="option-row">
                <span class="option-label">Msg Spacing (0-50px)</span>
                <input type="range" id="opt-msg-gap" min="0" max="50" value="10" oninput="updateSettings()">
            </div>
            <div class="option-row">
                <span class="option-label">Input-Msg Gap (0-100px)</span>
                <input type="range" id="opt-input-gap" min="0" max="100" value="20" oninput="updateSettings()">
            </div>
            <div class="option-row">
                <span class="option-label">Msg Padding (0-30px)</span>
                <input type="range" id="opt-msg-padding" min="0" max="30" value="10" oninput="updateSettings()">
            </div>
            <div class="option-row">
                <span class="option-label">Input Padding (0-30px)</span>
                <input type="range" id="opt-input-padding" min="0" max="30" value="10" oninput="updateSettings()">
            </div>
            <div class="option-row">
                <span class="option-label">Overall Scale (0.5x - 3.0x)</span>
                <input type="range" id="opt-scale" min="50" max="300" value="100" oninput="updateSettings()">
            </div>
            <hr>
            <div class="option-row">
                <button onclick="downloadTemplate()">Download CSS Template</button>
            </div>
        </div>
    </div>

    <div id="message-container"></div>

    <div id="input-container">
        <input type="text" id="text-input" placeholder="Type here..." autofocus autocomplete="off">
    </div>

    <script>
        // --- DOM Elements ---
        const inputField = document.getElementById('text-input');
        const msgContainer = document.getElementById('message-container');
        const toggleBtn = document.getElementById('toggle-btn');
        const optionsPanel = document.getElementById('options-panel');
        const root = document.documentElement;
        const dragOverlay = document.getElementById('drag-overlay');
        const themeStyleTag = document.getElementById('theme-style');

        // --- Typing Logic ---
        inputField.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                const text = inputField.value;
                if (text.trim() !== "") {
                    const msgDiv = document.createElement('div');
                    msgDiv.classList.add('message-box');
                    msgDiv.textContent = text;
                    msgContainer.appendChild(msgDiv);
                    msgContainer.scrollTop = msgContainer.scrollHeight;
                    inputField.value = "";
                    inputField.focus();
                }
            }
        });

        // --- Options Logic ---
        let isOptionsOpen = true;
        function toggleOptions() {
            isOptionsOpen = !isOptionsOpen;
            if (isOptionsOpen) {
                optionsPanel.classList.remove('hidden');
                toggleBtn.classList.remove('minimized');
            } else {
                optionsPanel.classList.add('hidden');
                toggleBtn.classList.add('minimized');
            }
        }

        function updateSettings() {
            const sideMargin = document.getElementById('opt-side-margin').value;
            const msgGap = document.getElementById('opt-msg-gap').value;
            const inputGap = document.getElementById('opt-input-gap').value;
            const msgPadding = document.getElementById('opt-msg-padding').value;
            const inputPadding = document.getElementById('opt-input-padding').value;
            const scaleRaw = document.getElementById('opt-scale').value;

            root.style.setProperty('--app-side-margin', sideMargin + 'px');
            root.style.setProperty('--app-msg-gap', msgGap + 'px');
            root.style.setProperty('--app-input-gap', inputGap + 'px');
            root.style.setProperty('--app-msg-padding', msgPadding + 'px');
            root.style.setProperty('--app-input-padding', inputPadding + 'px');
            root.style.setProperty('--app-scale', scaleRaw / 100);
        }
        updateSettings(); // Init

        // --- Drag and Drop CSS Logic ---
        window.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragOverlay.style.display = 'flex';
        });

        window.addEventListener('dragleave', (e) => {
            if (e.target === dragOverlay) {
                dragOverlay.style.display = 'none';
            }
        });

        window.addEventListener('drop', (e) => {
            e.preventDefault();
            dragOverlay.style.display = 'none';

            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.name.endsWith('.css')) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        themeStyleTag.innerHTML = event.target.result;
                        alert("Custom Style Applied: " + file.name);
                    };
                    reader.readAsText(file);
                } else {
                    alert("Please drop a valid .css file.");
                }
            }
        });

        // --- Download Template Logic ---
        function downloadTemplate() {
            const templateContent = `/* --- Basic CSS Template for Overlay --- */

/* 1. Main Background and Font */
body {
    background-color: white;       /* Background of the whole page */
    color: black;                  /* Default text color */
    font-family: "Times New Roman", serif; /* Font family */
}

/* 2. The Input Box (Where you type) */
#text-input {
    background-color: #eee;        /* Light gray background */
    color: black;                  /* Text color */
    border: 2px solid black;       /* Black border */
}

/* 3. The Sent Messages (The bubbles) */
.message-box {
    background-color: white;
    color: black;
    border: 2px solid black;
}

/* 4. The Options Panel (Top menu) */
#options-panel {
    background-color: #eee;
    border-bottom: 2px solid black;
    color: black;
}

/* 5. The Toggle Button (Top-left square) */
#toggle-btn {
    background-color: black;      /* Color when panel is OPEN */
    border: 2px solid black;
}

#toggle-btn.minimized {
    background-color: white;      /* Color when panel is CLOSED */
    /* Border remains from above unless you change it here */
}
`;
            const blob = new Blob([templateContent], { type: 'text/css' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'style-template.css';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
