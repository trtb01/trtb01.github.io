<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static HTML Encrypter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; line-height: 1.6; color: #333; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        .card { background: #f9f9f9; border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="file"], input[type="password"] { width: 100%; margin-bottom: 15px; padding: 10px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 15px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; width: 100%; }
        button:hover { background: #0056b3; }
        .note { font-size: 0.9em; color: #666; margin-top: -10px; margin-bottom: 15px; }
        #status { margin-top: 10px; font-weight: bold; color: green; }
    </style>
</head>
<body>

    <h1>Static Site Encrypter</h1>
    <p>Select your HTML file, choose a lock method, and download the secure version.</p>

    <div class="card">
        <label>1. Select HTML File to Encrypt</label>
        <input type="file" id="inputFile" accept=".html, .htm">
    </div>

    <div class="card">
        <label>2. Choose Security Method</label>
        <select id="authMethod" onchange="toggleAuthFields()" style="width:100%; padding: 10px; margin-bottom: 15px;">
            <option value="password">Password Only</option>
            <option value="keyfile">Keyfile (Maximum Security)</option>
        </select>

        <div id="passwordField">
            <label>Set Password</label>
            <input type="password" id="passwordInput" placeholder="Enter a strong password">
        </div>

        <div id="keyfileField" style="display:none;">
            <label>Select Keyfile</label>
            <input type="file" id="keyfileInput">
            <p class="note">Any file (image, mp3, doc) can be a key. You must have this exact file to unlock the page later.</p>
        </div>
    </div>

    <button onclick="processEncryption()">Encrypt & Download</button>
    <div id="status"></div>

    <script>
        function toggleAuthFields() {
            const method = document.getElementById('authMethod').value;
            document.getElementById('passwordField').style.display = method === 'password' ? 'block' : 'none';
            document.getElementById('keyfileField').style.display = method === 'keyfile' ? 'block' : 'none';
        }

        async function processEncryption() {
            const fileInput = document.getElementById('inputFile').files[0];
            const method = document.getElementById('authMethod').value;
            let secret = "";

            if (!fileInput) { alert("Please select an HTML file."); return; }

            // Get the "Secret" (either password or hashed keyfile)
            if (method === 'password') {
                secret = document.getElementById('passwordInput').value;
                if (!secret) { alert("Please enter a password."); return; }
            } else {
                const keyFile = document.getElementById('keyfileInput').files[0];
                if (!keyFile) { alert("Please select a keyfile."); return; }
                secret = await readFileAsBase64(keyFile); // Use file content as secret
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const htmlContent = e.target.result;
                const encrypted = CryptoJS.AES.encrypt(htmlContent, secret).toString();
                
                const template = generateDecryptorTemplate(encrypted, method);
                download(fileInput.name.replace('.html', '_secure.html'), template);
            };
            reader.readAsText(fileInput);
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result); // content of keyfile
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        function download(filename, text) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            document.getElementById('status').innerText = "File generated: " + filename;
        }

        // The Template for the OUTPUT file
        function generateDecryptorTemplate(encryptedData, method) {
            const keyfileInputHTML = `
                <label style="display:block; margin-bottom:10px;">Upload Keyfile to Unlock:</label>
                <input type="file" id="keyfile" style="margin-bottom:15px; width:100%;">
            `;
            const passwordInputHTML = `
                <input type="password" id="pass" placeholder="Enter Password" style="padding:10px; width:100%; box-sizing:border-box; margin-bottom:15px;">
            `;

            return `<!DOCTYPE html>
<html>
<head>
<title>Protected Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script>
<style>
    body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #eee; font-family: sans-serif; margin: 0; }
    .container { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 300px; text-align: center; }
    button { background: #333; color: white; border: none; padding: 10px 20px; cursor: pointer; width: 100%; border-radius: 4px; }
    button:hover { background: #555; }
</style>
</head>
<body>
<div class="container">
    <h3>Restricted Access</h3>
    ${method === 'keyfile' ? keyfileInputHTML : passwordInputHTML}
    <button onclick="unlock()">Unlock</button>
    <p id="error" style="color:red; font-size:14px; display:none; margin-top:10px;">Invalid credentials</p>
</div>

<script>
    const encrypted = "${encryptedData}";
    const method = "${method}";

    async function unlock() {
        let secret = "";
        if (method === 'password') {
            secret = document.getElementById('pass').value;
        } else {
            const kf = document.getElementById('keyfile').files[0];
            if (!kf) return;
            secret = await readFileAsBase64(kf);
        }

        try {
            const decrypted = CryptoJS.AES.decrypt(encrypted, secret).toString(CryptoJS.enc.Utf8);
            if (!decrypted) throw new Error();
            document.open();
            document.write(decrypted);
            document.close();
        } catch (e) {
            document.getElementById('error').style.display = 'block';
        }
    }

    function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(file);
        });
    }
<\/script>
</body>
</html>`;
        }
    </script>
</body>
</html>
