<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stark Player Red</title>
    <!-- Library to extract album art -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #000000;
            --fg-color: #ffffff;
            --accent-color: #FF0000; /* Pure Red */
            --border: 2px solid var(--fg-color);
        }

        * {
            box-sizing: border-box;
            border-radius: 0 !important; /* Enforce squared corners */
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background-color: var(--bg-color);
            color: var(--fg-color);
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            display: flex;
            flex-direction: row; /* Horizontal layout for Sidebar */
        }

        /* --- Right Sidebar (Title) --- */
        #right-sidebar {
            width: 80px; /* Fixed width for the vertical title */
            height: 100vh;
            border-left: var(--border);
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
            order: 2; /* Ensure it stays on the right */
        }

        #track-title {
            writing-mode: vertical-rl; /* Vertical text */
            text-orientation: mixed;
            transform: rotate(180deg); /* Reads bottom-to-top */
            color: var(--accent-color);
            font-weight: bold;
            font-size: 2rem;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 2px;
            max-height: 100%;
        }

        /* --- Main Layout Column --- */
        #main-column {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            order: 1;
            position: relative;
        }

        /* --- Top Button --- */
        #load-area {
            width: 100%;
            height: 60px; /* Fixed height for header area */
            border-bottom: var(--border);
            display: flex;
        }

        #load-btn {
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--fg-color);
            border: none;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.2rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: background 0.1s;
        }

        #load-btn:hover {
            background-color: #222;
        }

        #load-btn:active {
            background-color: #444;
        }

        /* --- Center Art Area --- */
        #art-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            overflow: hidden;
            position: relative;
        }

        #album-art {
            /* 5% margins implies max width/height of 90% */
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            /* Squared border, no shadow as requested */
            border: var(--border);
            display: none; 
        }

        #empty-state-msg {
            color: #333;
            text-align: center;
            display: block;
        }

        /* --- Bottom Controls --- */
        #controls-area {
            height: 10vh; /* Exactly 10% of height */
            width: 100%;
            border-top: var(--border);
            display: flex;
            flex-direction: row;
        }

        #play-btn {
            flex-grow: 4; /* Takes up "most" of the space */
            background-color: var(--bg-color);
            color: var(--fg-color);
            border: none;
            border-right: var(--border);
            font-family: inherit;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
        }

        #repeat-btn {
            flex-grow: 1; /* Takes up the rest */
            background-color: var(--bg-color);
            color: var(--fg-color);
            border: none;
            font-family: inherit;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            white-space: nowrap;
        }

        #play-btn:hover, #repeat-btn:hover {
            background-color: var(--fg-color);
            color: var(--bg-color);
        }

        .active-repeat {
            background-color: #333 !important;
            color: white !important;
            border-left: 5px solid var(--accent-color);
        }

        /* Hidden inputs */
        input[type="file"] { display: none; }
        
    </style>
</head>
<body>

    <!-- Main Content (Left Side) -->
    <div id="main-column">
        <!-- Top Bar -->
        <div id="load-area">
            <button id="load-btn">LOAD FILE / (CTRL+V for URL)</button>
            <input type="file" id="file-input" accept=".mp3, .flac, .wav, .ogg, audio/*">
        </div>

        <!-- Art Area -->
        <div id="art-area">
            <div id="empty-state-msg">NO FILE LOADED</div>
            <img id="album-art" src="" alt="">
        </div>

        <!-- Bottom Controls -->
        <div id="controls-area">
            <button id="play-btn">PLAY</button>
            <button id="repeat-btn">REPEAT: OFF</button>
        </div>
    </div>

    <!-- Right Sidebar (Title) -->
    <div id="right-sidebar">
        <div id="track-title"></div>
    </div>

    <!-- Hidden Audio Element -->
    <audio id="audio-player" crossorigin="anonymous"></audio>

    <script>
        const audioPlayer = document.getElementById('audio-player');
        const fileInput = document.getElementById('file-input');
        const loadBtn = document.getElementById('load-btn');
        const playBtn = document.getElementById('play-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const trackTitle = document.getElementById('track-title');
        const albumArt = document.getElementById('album-art');
        const emptyStateMsg = document.getElementById('empty-state-msg');

        let isRepeating = false;
        let isPlaying = false;

        // --- Interaction ---

        // 1. Load File Button
        loadBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // 2. File Selected
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const objectUrl = URL.createObjectURL(file);
                if (audioPlayer.src.startsWith('blob:')) {
                    URL.revokeObjectURL(audioPlayer.src);
                }
                loadTrack(objectUrl, file.name, file);
            }
        });

        // 3. Paste URL Support (Hidden Web Link Feature)
        document.addEventListener('paste', (e) => {
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            if (pastedText && (pastedText.startsWith('http') || pastedText.startsWith('www'))) {
                loadTrack(pastedText, pastedText, null);
            }
        });

        // 4. Play/Pause
        playBtn.addEventListener('click', togglePlay);

        // 5. Repeat
        repeatBtn.addEventListener('click', () => {
            isRepeating = !isRepeating;
            audioPlayer.loop = isRepeating;
            
            if (isRepeating) {
                repeatBtn.innerText = "REPEAT: ON";
                repeatBtn.classList.add('active-repeat');
            } else {
                repeatBtn.innerText = "REPEAT: OFF";
                repeatBtn.classList.remove('active-repeat');
            }
        });

        // Audio Events
        audioPlayer.addEventListener('ended', () => {
            if (!isRepeating) {
                isPlaying = false;
                playBtn.innerText = "PLAY";
            }
        });

        audioPlayer.addEventListener('error', () => {
            trackTitle.innerText = "ERROR LOADING FILE";
            playBtn.innerText = "ERR";
        });

        // --- Functions ---

        function loadTrack(src, name, fileObject) {
            audioPlayer.src = src;
            trackTitle.innerText = name;
            
            // Reset Art UI
            albumArt.style.display = 'none';
            albumArt.src = '';
            emptyStateMsg.style.display = 'block';
            emptyStateMsg.innerText = "LOADING METADATA...";

            // Metadata Extraction
            if (fileObject && window.jsmediatags) {
                window.jsmediatags.read(fileObject, {
                    onSuccess: function(tag) {
                        const tags = tag.tags;
                        
                        // Use ID3 Title if available, else filename
                        if(tags.title) {
                            trackTitle.innerText = tags.title.toUpperCase();
                            if(tags.artist) {
                                trackTitle.innerText += " - " + tags.artist.toUpperCase();
                            }
                        }

                        // Picture
                        if (tags.picture) {
                            const { data, format } = tags.picture;
                            let base64String = "";
                            for (let i = 0; i < data.length; i++) {
                                base64String += String.fromCharCode(data[i]);
                            }
                            const base64 = "data:" + format + ";base64," + window.btoa(base64String);
                            
                            albumArt.src = base64;
                            albumArt.style.display = 'block';
                            emptyStateMsg.style.display = 'none';
                        } else {
                            emptyStateMsg.style.display = 'none'; // Blank if no art
                        }
                    },
                    onError: function(error) {
                        console.log(error);
                        emptyStateMsg.style.display = 'none'; // Blank on error
                    }
                });
            } else {
                // Web Link or no lib
                emptyStateMsg.style.display = 'none'; // Blank for web links
            }

            // Play
            audioPlayer.play().then(() => {
                isPlaying = true;
                playBtn.innerText = "PAUSE";
            }).catch(e => {
                isPlaying = false;
                playBtn.innerText = "PLAY";
            });
        }

        function togglePlay() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                isPlaying = true;
                playBtn.innerText = "PAUSE";
            } else {
                audioPlayer.pause();
                isPlaying = false;
                playBtn.innerText = "PLAY";
            }
        }
    </script>
</body>
</html>

